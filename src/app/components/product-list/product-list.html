<section class="products-section">
  <!-- Carrusel -->
  <app-carousel></app-carousel>

  <div class="container">
    <h2>Productos Destacados</h2>
    
   
    <!-- Filtros y Controles -->
    <div class="controls-section">
      <!-- Filtros por categoría -->
      <div class="category-filters" *ngIf="!isLoading && allProducts.length > 0">
        <button 
          (click)="filterByCategory('')" 
          [class.active]="!selectedCategory"
          class="category-btn">
          Todos
        </button>
        <button 
          *ngFor="let category of getCategories()"
          (click)="filterByCategory(category)" 
          [class.active]="selectedCategory === category"
          class="category-btn">
          {{ category }}
        </button>
      </div>

      <!-- Toggle entre destacados y todos -->
      <div class="view-toggle" *ngIf="!isLoading && allProducts.length > 0">
        <button 
          (click)="showFeatured()" 
          [class.active]="!showAllProducts"
          class="toggle-btn">
          Destacados
        </button>
        <button 
          (click)="showAll()" 
          [class.active]="showAllProducts"
          class="toggle-btn">
          Todos los Productos
        </button>
      </div>
    </div>
    
    <!-- Indicador de resultados -->
    <div class="results-info" *ngIf="!isLoading && filteredProducts.length > 0">
      <p>
        Mostrando 
        <strong>{{ filteredProducts.length }}</strong> 
        producto{{ filteredProducts.length !== 1 ? 's' : '' }}
        <span *ngIf="searchTerm">para "{{ searchTerm }}"</span>
        <span *ngIf="selectedCategory">en {{ selectedCategory }}</span>
      </p>
    </div>
    
    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="loading">
      <p>Cargando productos...</p>
    </div>

    <!-- Mensaje cuando no hay productos -->
    <div *ngIf="!isLoading && filteredProducts.length === 0" class="no-products">
      <p *ngIf="searchTerm">No se encontraron productos para "{{ searchTerm }}"</p>
      <p *ngIf="selectedCategory && !searchTerm">No hay productos en la categoría "{{ selectedCategory }}"</p>
      <p *ngIf="!selectedCategory && !searchTerm">No hay productos disponibles</p>
      <button *ngIf="searchTerm || selectedCategory" (click)="searchTerm = ''; selectedCategory = ''; showFeatured()" 
              class="btn-secondary">
        Ver todos los productos
      </button>
    </div>

    <!-- Grid de productos -->
    <div *ngIf="!isLoading && filteredProducts.length > 0" class="products-grid">
      <div *ngFor="let product of filteredProducts" class="product-card">
        <div class="product-image">
          <img 
            *ngIf="product.imagen && product.imagen !== ''" 
            [src]="product.imagen" 
            [alt]="product.nombre"
            (error)="product.imagen = ''"
          >
          <div *ngIf="!product.imagen || product.imagen === ''" class="image-placeholder">
            {{ product.nombre.charAt(0) }}
          </div>
        </div>
        <div class="product-info">
          <h3>{{ product.nombre }}</h3>
          <p class="price">${{ product.precio.toFixed(2) }}</p>
          <p class="category">{{ product.categoria }}</p>
          <p class="description">{{ product.descripcion }}</p>
          <div class="stock-status" [class.in-stock]="product.stock > 0" [class.low-stock]="product.stock > 0 && product.stock <= 5">
            {{ product.stock > 0 ? (product.stock <= 5 ? 'Últimas unidades' : 'En stock') : 'Agotado' }}
            <span *ngIf="product.stock > 0">({{ product.stock }})</span>
          </div>
          <div class="product-actions">
            <button 
              (click)="addToCart(product)" 
              [disabled]="product.stock === 0"
              class="btn-primary">
              Agregar al Carrito
            </button>
            <button 
              (click)="viewDetails(product.id)"
              class="btn-secondary">
              Ver detalles
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón para cargar más productos -->
    <div *ngIf="!isLoading && !showAllProducts && filteredProducts.length === featuredProducts.length" 
         class="load-more-section">
      <button (click)="showAll()" class="btn-primary load-more-btn">
        Ver Todos los Productos ({{ allProducts.length }})
      </button>
    </div>
  </div>
</section>